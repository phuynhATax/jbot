version: "3.8"

services:
  chatbot:
    build: ./chatbot
    container_name: pd_chatbot_node
    restart: unless-stopped
    environment:
      NODE_ENV: production
      OPENAI_API_KEY_2: ${OPENAI_API_KEY_2}
      PORT: 9000
    expose:
      - "9000"                # expose internally for proxy, not necessarily public
    ports:
      - "9000:9000"           # optional if IT proxy targets host:9000
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/healthz"]
      interval: 30s
      timeout: 10s
      retries: 5

  chatbot_ui:
    build: ./chatbot-ui
    container_name: pd_chatbot_ui
    restart: unless-stopped
    environment:
      # Use relative path for production (reverse proxy same domain)
      # so React build calls "/api/chat" instead of absolute host URL
      - REACT_APP_API_URL=/api/chat
    ports:
      - "9001:80"             # optional if IT proxy targets host:9001
    depends_on:
      chatbot:
        condition: service_healthy

volumes:
  n8n_data:
